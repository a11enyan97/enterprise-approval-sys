# 项目架构说明

## 文件夹结构

```
enterprise-approval-sys/
├── app/                    # Next.js App Router
│   ├── api/               # API 路由（后端）
│   │   ├── _shared/       # 共享工具（错误处理、验证器等）
│   │   └── approval/      # 审批相关 API
│   └── approval/          # 审批相关页面
│       ├── components/    # 页面组件
│       └── info/          # 审批详情/编辑页面
├── lib/                   # 工具库
│   └── api/               # API 客户端
│       ├── client.ts      # 通用 API 请求函数
│       └── approval.ts    # 审批相关 API 调用
├── hooks/                 # React Hooks
│   └── useApprovalList.ts # 审批列表数据获取 Hook
├── types/                  # TypeScript 类型定义
│   └── approval.ts        # 审批相关类型
└── prisma/                # 数据库相关
    └── schema.prisma      # 数据库模型定义
```

## 架构说明

### 1. API 层 (`app/api/`)
- **职责**: 处理 HTTP 请求，调用 service 层
- **位置**: `app/api/approval/route.ts`
- **特点**: 
  - 使用 Next.js Route Handlers
  - 统一的错误处理
  - 参数验证和转换

### 2. Service 层 (`app/api/approval/service.ts`)
- **职责**: 业务逻辑处理，数据库操作
- **特点**:
  - 数据验证
  - 业务规则处理
  - Prisma 数据库操作

### 3. API 客户端 (`lib/api/`)
- **职责**: 前端调用后端 API
- **文件**:
  - `client.ts`: 通用请求函数（GET、POST、PUT、DELETE）
  - `approval.ts`: 审批相关 API 封装
- **特点**:
  - 统一的请求/响应处理
  - 错误处理
  - TypeScript 类型支持

### 4. Hooks (`hooks/`)
- **职责**: 封装数据获取逻辑，提供响应式数据
- **文件**: `useApprovalList.ts`
- **特点**:
  - 自动数据获取
  - 加载状态管理
  - 错误处理
  - 支持刷新

### 5. 类型定义 (`types/`)
- **职责**: 定义 TypeScript 类型和接口
- **文件**: `approval.ts`
- **特点**:
  - 统一的类型定义
  - 类型安全
  - 便于维护

## 数据流

```
前端页面 (app/approval/page.tsx)
    ↓
Hook (hooks/useApprovalList.ts)
    ↓
API 客户端 (lib/api/approval.ts)
    ↓
后端 API (app/api/approval/route.ts)
    ↓
Service 层 (app/api/approval/service.ts)
    ↓
数据库 (Prisma)
```

## 使用示例

### 在组件中使用 Hook

```typescript
import { useApprovalList } from "@/hooks/useApprovalList";

function MyComponent() {
  const { data, loading, error, refetch } = useApprovalList({
    page: 1,
    pageSize: 10,
    status: "pending",
  });

  if (loading) return <Spin />;
  if (error) return <Message error={error.message} />;

  return <Table data={data?.data} />;
}
```

### 直接调用 API

```typescript
import { getApprovalList, submitApprovalRequest } from "@/lib/api/approval";

// 获取列表
const result = await getApprovalList({ page: 1, pageSize: 10 });

// 提交申请
await submitApprovalRequest(123);
```

## 最佳实践

1. **类型安全**: 始终使用 TypeScript 类型
2. **错误处理**: 使用统一的错误处理机制
3. **代码复用**: 通过 Hooks 和 API 客户端复用逻辑
4. **关注点分离**: 页面组件只负责 UI，业务逻辑在 Hooks 和 Service 层
5. **可维护性**: 清晰的文件夹结构，便于查找和维护

